<div class="container py-4">
  <div class="row g-4">

    <!-- CALENDARIO -->
    <div class="col-lg-5">

      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-3">
        <button class="btn btn-outline-secondary btn-sm" (click)="cambiarMes(-1)">‹</button>
        <h4 class="text-capitalize mb-0">{{ monthName }}</h4>
        <button class="btn btn-outline-secondary btn-sm" (click)="cambiarMes(1)">›</button>
      </div>

      <!-- Weekdays -->
      <div class="row text-center fw-bold small text-muted mb-1">
        <div class="col" *ngFor="let d of weekDays">{{ d }}</div>
      </div>

      <!-- Weeks -->
      <div *ngFor="let semana of semanas" class="row g-1">
        <div class="col" *ngFor="let dia of semana">
          <div
            class="border rounded position-relative d-flex justify-content-center align-items-center"
            style="height: 60px;"
            [ngClass]="{
              'bg-light text-muted': !dia.isCurrentMonth,
              'bg-white cursor-pointer': dia.isCurrentMonth,
              'bg-proyecto text-dark cursor-pointer': dia.isCurrentMonth && dia.proyectos.length > 0
  
            }"
          >
            <ng-container *ngIf="dia.date">
              <span>{{ dia.date.getDate() }}</span>

              <!-- indicador -->
              <div
                *ngIf="dia.proyectos.length > 0"
                class="position-absolute bottom-0 start-50 translate-middle-x bg-warning rounded-circle"
                style="width: 7px; height: 7px;"
              ></div>

              <!-- <button
                *ngIf="dia.proyectos.length > 0"
                class="stretched-link"
                (click)="seleccionarProyecto(dia.proyectos[0])"
              ></button> -->

            <button
              *ngIf="dia.proyectos.length > 0"
              class="stretched-link btn-reset"
              (click)="seleccionarProyecto(dia.proyectos[0])"
            ></button>

<!-- 
              <div (click)="seleccionarProyecto(dia.proyectos[0])"
     class="position-absolute top-0 start-0 w-100 h-100">
</div> -->

            </ng-container>
          </div>
        </div>
      </div>
    </div>

    <!-- DETALLES -->
    <div class="col-lg-7">
    <div *ngIf="selected; else noSel" 
     class="card shadow-sm"
     @detalleAnim>
        <div class="card-body">
          <h4 class="card-title mb-2">{{ selected.nombre }}</h4>
          <p class="card-text text-muted">{{ selected.descripcion }}</p>

          <!-- TIME LEFT -->
          <div
            class="alert mt-3"
            [ngClass]="{
              'alert-danger': vencido(selected),
              'alert-success': !vencido(selected)
            }"
          >
            <ng-container *ngIf="vencido(selected); else rest">
              Proyecto vencido ({{ diasRestantes(selected) }} días atrás)
            </ng-container>
            <ng-template #rest>
              Faltan <strong>{{ diasRestantes(selected) }}</strong> días
            </ng-template>
          </div>

          <p class="small text-muted mt-2">
            Fecha de entrega: {{ selected.fecha_entrega | date: 'longDate' }}
          </p>
        </div>
      </div>

      <!-- Sin selección -->
      <ng-template #noSel>
        <div class="alert alert-secondary text-center py-5" @noSelAnim>
          Selecciona un evento del calendario<br>

          <div *ngIf="nextProject" class="mt-3">
            <strong>Proyecto más cercano de {{ monthText}}</strong><br>
            {{ nextProject.nombre }} — {{ nextProject.fecha_entrega | date }}
          </div>
            <!-- Cantidades por mes -->
          <div>


          <div class="mt-3">
            <strong>Proyectos pendientes en {{ monthText}}:</strong><br>
              {{ proyectosMesActual }}
            </div>

            <div class="mt-3">
              <strong>Proyectos en el mes siguiente:</strong><br>
              {{ proyectosMesSiguiente }}
            </div>
          </div>


        </div>
        
      </ng-template>

    </div>
  </div>
</div>